- BUG: ESP8266 lots of comm errors although latency is very low. Why?
- BUG: Time counter not reset after disconnect: 147:18 ????
- BUG?: UIApplication.idleTimer not enabled when disconnected from vehicle: ?? Don't see how that would be possible

- BUG: Cleanflight_Configurator.TCPComm userCancelledReconnection:]: message sent to deallocated instance 0x174150cd0
- MAVLink: detect failsafe condition: No RC Receiver, Battery, ...
  system_status == MAV_STATE.CRITICAL => failsafe, then use sensors health to find out what's wrong (radio) battery?, gcs?, ekf? MP/CurrentState.cs
- MAVLink initial setup:
  Mandatory: frame type, Accel calib, Accel level calib, compass (general config, enable compass 1,2,3, calibration, on-board calib), Rx calib / DSM bind, ESC calib, Flight modes, Failsafe
  Optional: SiK radio, Battery monitors 1&2, Compass motor calib, Sonar, Airspeed, Optical flow, OSD, Cam gimbal, Antenna tracker, Motor test, Bluetooth, Parachute
- MAVLink config/tuning: Flight modes, GeoFence, Basic tuning (RC feel, Roll/pitch sensitivity, Throttle Hover), Extended tuning (PID params), Standard params (arming checks, autotune_axes, batt_, batt2_, cam_trig, and many more), Advanced params (lots of stuff), Full parameter list/tree
-> Pre-flight: accel level calib, compass calib??, Rx calib??, Flight modes, Failsafe?, GeoFence, Arming checks, Sensors health?
- Animate scales to have smoother movement (sometimes they seem to go backward)

- TCP/IP: Try UDP instead of TCP
- BUG CLI issue: buffer overrun?
- Alarm: Altitude low and high alarms, RTH fence alarm, Amperage, mAh consumed, etc.
- TCP/IP: Try UDP instead of TCP
- LED programming
- RC Sticks: Add switches AUX 1-4, display configured modes
- Failsafe: allow to choose configured mode for Aux channels set value
- Support for cleanflight 1.12: MSP_(SET_)TRANSPONDER_CONFIG (?) supported(1), data, MSP_(SET_)RC_DEADBAND (3), MSP_(SET_)SENSOR_ALIGNMENT(3), MSP_SDCARD_SUMMARY, MSP_(SET_)BLACKBOX_CONFIG, MSP_(SET_)3D
- Replay: When switching to other app or springboard, time counter should be paused
- RC Sticks depend on channel order set in Receiver tuning. Should be independent! Option for Mode 2/Mode 1 may be.
- Mark inactive panels/gauge with red cross
- UAV Health page (sensors, etc.) / Pre-flight checks page -> merge with Calibration
  - Calibrate accelerometer
  - Calibrate magnetometer
  - Active sensors
  - GPS Status: fix, num sats
  - RC check
  - Motors check
  - RSSI ?
  - FPV / video check
  - Weather conditions (METAR see above)
  - No-fly zone: DJI uses noflyzone.org. Not public. Seems to be only list of airports with radius plus some warning points/areas (stade de france, parc des princes, élysée, etc.) (See http://www.dji.com/flysafe/no-fly and http://www.dji.com/fly-safe/category-mc?www=v1)
    http://overpass-api.de/query_form.html (node ["aeroway"="aerodrome"] (47.5,1.5,49.5,3.5); >;); out;
    Works but size of airport missing.
  - Battery check
  - Failsafe check
  - and Accelerometer trim (not really related but don't know where to put it...)
- ESP8266: May be better to create ad-hoc network on iPhone (Personal Hotspot) and have ESP8266 connect to it. Or better yet, use portable access point (DJI Phantom Range Extender).
- Replay: When an internal error happens, not related to the log file; it is trapped and the message says "invalid flight file"
- Licensing: Also add our own version number
    + many icons/images stolen from Cleanflight Configurator
    + calibrate icon stolen on the web
- Replay: visual indication of replay (pause/play, FF, REW ?)
- When ARMED, disable Configuration, Motor testing, receiver config?, Modes?, Dataflash, CLI
- Map: Allow tapping on drone annotation, change annotation when GPS Fix lost (blink?)
- Telemetry (map?): Display active profile, communication speed?
- Map: Map type (sat, hybrid, map)
- Backup / Restore
- Ability to name models: use cleanflight UID and BT uuid to identify it. Alert levels settings (Alt, Amp, mAh, etc.) are specific to model

- Comm: Use FPV audio channel to transmit data (ImmersionRC EzOSD)

- Hardware targets for iOS 8+ (http://iossupportmatrix.com/)
    iPad2 (No BLE support)
    iPhone 4S
    new iPad
    iPod Touch (5th gen)
    iPad mini
    iPhone 5
    iPad (10/2012)
    iPhone 5c
    iPhone 5s
    iPad Air
    iPad mini 2
    iPhone 6
    iPhone 6+
    iPad Air 2
    iPad mini 3

DONE:
- Remove borders of text field in config and elsewhere. See Pages
- Replay: disable buttons and tabs that are N/A: Config, Motors, Receiver, Modes, calib, pid, dataflash, about
- Reset AircraftModel when connecting and when starting replay
- Record: For each session, display date
- Licensing: Put this in Settings.app (Acknoledgements)
    + map, tuning, (new calibrate), battery, signal icons "designed by Freepik" mandatory in credits
    + compass: <div>Icons made by <a href="http://www.flaticon.com/authors/yannick" title="Yannick">Yannick</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a>             is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0">CC BY 3.0</a></div>
- MyUINavigationController "Back" button detector doesn't work if launched from "More..." VC
- Units: metrics / imperial
- Record: move to Settings. "Log flight data" on/off will record flight data for every flight
- Replay: dump full AircraftModel at start of session.
- Finish Settings: detect pref changes, set default prefs, etc.
- Record: For each session, display location, distance, duration, max alt, ... (See DJI GO)
- Alarms: GPS Fix and Battery Low only checked in Telemetry VC
- Comm: Detect when no more data is coming in, display alert
- Comm: AppDelegate timer should not be on main queue -> when UI is busy, timer is not firing. -> solution: Main run loop, yes, but not in default mode
- TCP: Connection timeout is triggered if disconnecting within 5 secs
- TCP: Need to be able to cancel connection b/c it sometimes spins forever
- TCP: Connection timeout doesn't work if host is unreachable to start with (bogus dns name) -> Network lost in reachability
- TCP: Access violation due to reachability callback being called after connection is closed
Disconnected drone+dongle. Cannot dismiss "Connection lost. Reconnecting". Log:
2016-01-13 00:25:16.649 Cleanflight Configurator[6171:1715806] Bandwidth in: 0.0 kbps (0%)
2016-01-13 00:25:17.649 Cleanflight Configurator[6171:1715806] Bandwidth in: 0.0 kbps (0%)
2016-01-13 00:25:18.650 Cleanflight Configurator[6171:1715806] Bandwidth in: 0.0 kbps (0%)
2016-01-13 00:25:19.345 Cleanflight Configurator[6171:1724301] NSStreamEvent.ErrorOccurred: <__NSCFOutputStream: 0x1703022e0>
2016-01-13 00:25:19.346 Cleanflight Configurator[6171:1724301] Connecting...
2016-01-13 00:25:19.593 Cleanflight Configurator[6171:1724301] Communication closed
2016-01-13 00:27:49.624 Cleanflight Configurator[6171:1715806] NSStreamEvent.ErrorOccurred: <__NSCFOutputStream: 0x1743044a0>
2016-01-13 00:27:49.625 Cleanflight Configurator[6171:1715806] Communication error

Then BAD_ACCESS_EXCEPTION in reachability callback
- Comm: 0.5 sec receive timeout is too short. 0.75 -> 1 sec?
- Comm: Disconnecting with "no data received" dialog visible, doesn't hide it
- Telemetry2: Need to retrieve Misc(?) for battery ranges
- Telemetry: Time counter since arming
- Comm: Test 3DR Telemetry radio (= HKPilot tranceiver telemetry)
- Initial handshake very unstable with 3dr. BOXNAMES message beginning is truncated/doesn't come through.
Investigation shows that small packets (<=32 bytes) are reliable but success rate decreases starting with 64-byte packets:
packet size         error rate
16                  0
32                  0
64                  0.05 ?
72                  1/[15-20]
80                  1/12
96                  worse
128                 worst

Implementing some post-1.8 fixes seem to help a lot: https://github.com/Dronecode/SiK/commit/546e1ab09595ea5cff9bfd7bb912a4ae4c0202e0#diff-a940a548ba41bc988f99d51fd02f21de
Now running 1.9+ with Multiwii patches. Seems to work fine.
- Follow Me: only works with Telemetry screen
- Telemetry (map?): Display battery Amps, mAh consumed
- Variometer
- Map: Draw heading of drone on map. Using arrow shape instead of circle.
- Modes: "Plus" buttons don't work well because of frequent table updates
- When communication is interrupted, check that outgoing msgs do not accumulate in outgoing buffer
- BEFORE RELEASE: Remove/hide Dataflash tab
- Show when vehicle ARMED/DISARMED
- Receiver: colors mismatched b/c of row re-use?
- RC STicks: issue when view disappearing -> commands not provided back when visible.
- Switching quickly (?) WHEN RC STICKS ARE ON to Map -> Bottom nav bar is hidden. No way to navigate.
- App icon
- Sexy launch screen and connection page
- CF can issue $M! packets for error cases. Happens for unknown MSP codes (or not compiled-in such as GPS in betaflight)
- CLI support
- Spurious network reachability callback, way after tcp/ip connection was closed
- Replay: NSKeyedArchiver throws NPE on invalid (truncated) archive
- RC Sticks: confusing. Users expect them to show the current sticks position
- Alt Hold and Mag Hold bugs are not refreshed when updated by the FC (using sticks or GPS NAV)
- Flight Recorder: add data/time of session in file
- Speed, altitude indicator and variometer are in metric units, regardless of user settings
- Replay: detailed row: the DTH icon is in blue in some cases
- Switch to nautical mile for DTH when > 1 mile
- iPhone 4 support: No because BLE not supported
- Started app: switched to bluetooth tab, cannot refresh b/c "Refreshing..." disabled -> Bluetooth was turned off. Working as designed. iOS pops up an alert to enable Bluetooth.
- Map: Add pin for RTH location and current Pos Hold
- Map: Tapping on map shows "Go There" button -> Waypoint
- PID tuning: support for MSP_SET_RESET_CURR_PID (1.12+)
- Telemetry: Air mode indicator
- StaticDataTableViewController: Section footers are not hidden (https://github.com/peterpaulis/StaticDataTableViewController/issues/18)
- Support for cleanflight 1.12: failsafe config (MSP_(SET_)RXFAIL_CONFIG, MSP_(SET_)FAILSAFE_CONFIG, MSP_(SET_)RXFAIL_CONFIG
- Spektrum RSSI (firmware): low value even when signal should be ok (Down to 14 on 17/02/16 at 15:47)
- Crash when enabling Follow Me (v1.1): negative longitude raises an exception in writeInt32()
- Tab bar navigation settings (icon order, More, ...) is not saved
- Bluetooth: Module sometimes appears twice
- Support for Red Bear Lab BLEMini modules
- MAVLink: heading and altitude bugs are not correct (just follow current heading, alt). See if we can have a vspeed and speed bugs as well
- MAVLink: Navigate to waypoint: doesn't work
- If armed while not on telemetry page, ARMED blinks red when displaying it even several minutes after actual armed action -> event
- BUG: set contentMode to .Redraw for all custom drawn controls
- Cancel/Save/Refresh buttons in views -> use "system item" for UIBarButtonItem
- Move Settings into app
- Imperial units: Should be able to choose between NM / kn and mile / mph
- BUG: Always put a space between number and unit
- BUG: Many x3 icons are actually x4
- BUG: iNav save config fails on message 114 MSP_MISC (id INAV, version 1.1.0, API 1.15) -> Increased delay after reboot to 3 sec
- BUG: Acc Trim values not saved (to eeprom)? (Error on iNav msg 239 MSP_SET_ACC_TRIM)
- AppDelegate.stayAliveTimer should probably be invalidated when switching to background and !armed
- Background mode: app can receive and send data via BT even when in background. Need to keep the AppDelegate timer running (only when armed) when entering background. See https://developer.apple.com/library/ios/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothBackgroundProcessingForIOSApps/PerformingTasksWhileYourAppIsInTheBackground.html
- for i in 0..<max: some done. Remaining will be done as needed.
- Use adaptive update frequency based on latency/comm bandwidth. See ardupilot/libraries/GCS_MAVLink/GCS_Common.cpp: 591
- Weather info for current location using METAR (https://aviationweather.gov/gis/scripts/MetarJSON.php?bbox=1,47,4,50&density=all)
- N/A. Telemetry-only mode (passive): MSP_BOXNAMES,MSP_STATUS,MSP_IDENT,MSP_RAW_IMU,MSP_ALTITUDE,MSP_RAW_GPS,MSP_RC,MSP_ATTITUDE,MSP_SERVO. "Almost nobody uses it...". Removed in 1.11?)
- REMOVED Background mode: BLE supposedly only wakes up the app "if the peripheral delivers an update" (https://developer.apple.com/library/ios/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/BackgroundExecution/BackgroundExecution.html#//apple_ref/doc/uid/TP40007072-CH4-SW54)
    Wi-Fi: must implement func application(_ application: UIApplication, performFetchWithCompletionHandler completionHandler: (UIBackgroundFetchResult) -> Void) in app delegate

